<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>注文メモ モック（UI+ピン+ラベル）</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,600,0,0" rel="stylesheet">

  <style>
    :root{
      --bg:#f8fafc;
      --text:#0f172a;
      --muted:#64748b;
      --line:#e2e8f0;
      --primary:#2563eb;
      --shadow: 0 12px 36px rgba(2,6,23,.12);
      --r:20px;
      --tap:44px;
      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Noto Sans JP", system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing: antialiased;
    }
    .viewport{
      width:390px;height:844px;margin:0 auto;position:relative;overflow:hidden;background:var(--bg);
    }
    @media (max-width: 430px){ .viewport{width:100vw;height:100dvh;margin:0} }

    .bar{
      position:absolute;left:0;right:0;top:0;z-index:20;
      padding: calc(10px + var(--sat)) calc(12px + var(--sar)) 10px calc(12px + var(--sal));
      background: rgba(248,250,252,.92);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
      display:flex;align-items:center;gap:10px;
    }
    .title{min-width:0;flex:1}
    .title .h{font-weight:800;font-size:15px;letter-spacing:-0.02em}
    .title .s{font-size:12px;color:var(--muted);font-weight:500;display:none}

    .btn{
      font-family: inherit;

      height:var(--tap);padding:0 12px;border-radius:14px;
      border:1px solid var(--line);background:#fff;
      font-weight:700;font-size:14px;cursor:pointer;
      display:inline-flex;align-items:center;gap:8px;
      box-shadow: 0 1px 0 rgba(2,6,23,.03);
      user-select:none;-webkit-tap-highlight-color: transparent;
    }
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
    .btn.ghost{background:transparent;border-color:transparent;box-shadow:none;color:var(--muted)}
    .btn.icon{padding:0 10px}

    .msr{font-family:"Material Symbols Rounded";font-weight:600;font-size:18px;line-height:1}

    .stage{
      position:absolute;left:0;right:0;
      top: calc(64px + var(--sat));
      bottom: calc(56px + var(--sab));
      padding: 14px;
      display:flex;align-items:center;justify-content:center;
    }

    /* Empty (top screen) */
    .empty{
      width:100%;
      border:1px solid var(--line);
      border-radius:var(--r);
      background:#fff;
      box-shadow: var(--shadow);
      padding:18px;
      display:none;
    }
    .empty.on{display:block}
    .emptyHero{
      border-radius:18px;
      border:1px solid var(--line);
      background: linear-gradient(135deg, rgba(37,99,235,.14), rgba(20,184,166,.10), rgba(2,6,23,.02));
      height:220px;
      display:flex;align-items:center;justify-content:center;
      margin-bottom:14px;
      position:relative;
      overflow:hidden;
    }
    .emptyHero::after{
      pointer-events:none;
      content:"";
      position:absolute;inset:-60px;
      background:
        radial-gradient(circle at 20% 30%, rgba(37,99,235,.22), transparent 55%),
        radial-gradient(circle at 70% 20%, rgba(20,184,166,.18), transparent 55%),
        radial-gradient(circle at 60% 80%, rgba(2,6,23,.08), transparent 55%);
      transform: rotate(6deg);
      filter: blur(0.2px);
    }
    .emptyGlyph{
      position:relative;z-index:1;
      display:flex;align-items:center;justify-content:center;
      width:84px;height:84px;
      border-radius:24px;
      background: rgba(255,255,255,0);
    }
    .emptyGlyph .msr{
      font-size:56px;
      color: rgba(255,255,255,.92);
      text-shadow: 0 10px 26px rgba(2,6,23,.22);
    }
    .emptyH{font-weight:800;font-size:16px;letter-spacing:-0.02em}
    .emptyS{margin-top:6px;color:var(--muted);font-size:12px;font-weight:500;line-height:1.45}
    .emptyRow{display:flex;gap:10px;margin-top:14px}
    .emptyRow .btn{
      font-family: inherit;
flex:1;justify-content:center}
    .emptyHint{margin-top:12px;color:var(--muted);font-size:12px;font-weight:500}

    /* Photo canvas */
    .canvas{
      width:100%;
      aspect-ratio:3/4;
      border-radius:var(--r);
      border:1px solid var(--line);
      overflow:hidden;
      background:#eef2ff;
      box-shadow: var(--shadow);
      position:relative;
      display:none;
    }
    .canvas.on{display:block}
    .menu img{width:100%;height:100%;object-fit:cover;display:block;filter:saturate(1.03) contrast(1.02)}
    .hint{
      position:absolute;left:10px;top:10px;
      background:rgba(255,255,255,.90);
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      font-weight:600;
      box-shadow: 0 8px 22px rgba(2,6,23,.10);
      pointer-events:none;
    }

    /* Pins: map-pin via SVG */
    .pin{
      position:absolute;
      width:44px;height:44px;
      transform:translate(-50%,-100%); /* tip anchors to point */
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .pin svg{
      position:absolute;left:0;top:0;width:44px;height:44px;
      filter: drop-shadow(0 14px 22px rgba(2,6,23,.18));
    }
    .pin .qty{
      position:absolute;left:50%;top:50%;
      transform: translate(-50%,-72%);
      font-weight:800;font-size:12px;letter-spacing:-0.01em;
      color:#0f172a;
      background: rgba(255,255,255,.88);
      border: 1px solid rgba(226,232,240,.9);
      border-radius: 999px;
      padding: 2px 7px;
      backdrop-filter: blur(6px);
      pointer-events:none;
    }
    .pin .label{
      position:absolute;left:50%;top:6px;
      transform: translate(-50%,-100%);
      max-width: 170px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(226,232,240,.95);
      color:#0f172a;
      font-size:12px;
      font-weight:600;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      backdrop-filter: blur(8px);
      box-shadow: 0 10px 22px rgba(2,6,23,.10);
      pointer-events:none;
    }
    .pin:active{transform:translate(-50%,-100%) scale(0.98);}

    /* Bottom bar */
    .bottom{
      position:absolute;left:0;right:0;bottom:0;z-index:20;
      padding: 10px calc(12px + var(--sar)) calc(10px + var(--sab)) calc(12px + var(--sal));
      background: rgba(248,250,252,.92);
      backdrop-filter: blur(10px);
      border-top:1px solid var(--line);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .sum{font-weight:800;font-size:13px}
    .sum small{font-weight:500;color:var(--muted);font-size:12px}

    /* Sheet (help) */
    .sheet{position:absolute;inset:0;display:none;z-index:40;background:rgba(2,6,23,.35)}
    .sheet.on{display:block}
    .sheetCard{
      position:absolute;left:14px;right:14px;bottom: calc(14px + var(--sab));
      background:#fff;border:1px solid var(--line);border-radius:22px;
      padding:14px;box-shadow: var(--shadow);
    }
    .sheetTitle{font-weight:800}
    .sheetText{margin-top:8px;color:var(--muted);font-size:12px;line-height:1.5}
    .sheetRow{display:flex;gap:10px;margin-top:12px}
    .sheetRow .btn{
      font-family: inherit;
flex:1;justify-content:center}

    /* Label modal */
    .labelModal{position:absolute;inset:0;display:none;z-index:50;background:rgba(2,6,23,.35)}
    .labelModal.on{display:block}
    .labelCard{
      position:absolute;left:14px;right:14px;bottom: calc(14px + var(--sab));
      background:#fff;border:1px solid var(--line);border-radius:22px;
      padding:14px;box-shadow: var(--shadow);
    }
    .labelTitle{font-weight:800}
    .labelSub{margin-top:6px;color:var(--muted);font-size:12px;line-height:1.5;font-weight:500}
    .labelInput{
      width:100%;height:44px;border-radius:14px;border:1px solid var(--line);
      background:#f8fafc;padding:0 12px;font-size:14px;outline:none;margin-top:10px;
      font-family: inherit;
    }
    .labelRow{display:flex;gap:10px;margin-top:12px}
    .labelRow .btn{
      font-family: inherit;
flex:1;justify-content:center}
  </style>
</head>
<body>
  <div class="viewport">
    <div class="bar">
      <div class="title">
        <div class="h">注文メモ</div>
        <div class="s" id="sub"></div>
      </div>
      
      <button class="btn" id="btnResetHeader"><span class="msr">restart_alt</span>撮り直し</button>
<button class="btn" id="btnShow" disabled><span class="msr">visibility</span>店員に見せる</button>
    </div>

    <div class="stage">
      <div class="empty on" id="empty">
        <div class="emptyHero">
          <div class="emptyGlyph" aria-hidden="true"><span class="msr">photo_camera</span></div>
        </div>
        <div class="emptyH">まずは写真（デモ）を用意</div>
        <div class="emptyS">このHTMLはUI/操作確認用。<br>「デモ写真で開始」でピンを置ける画面に進む。</div>
        <div class="emptyRow">
          <button class="btn primary" id="btnDemo"><span class="msr">image</span>デモ写真で開始</button>
          <button class="btn" id="btnBlank"><span class="msr">grid_view</span>白紙で開始</button>
        </div>
        <div class="emptyHint">操作：写真（白紙）を<strong>タップ</strong>でピン追加／ピン<strong>タップ</strong>で+1／ピン<strong>長押し</strong>でメニュー名</div>
      </div>

      <div class="canvas" id="canvas" aria-label="メニュー">
        <div class="menu"><img id="img" alt="メニュー" /></div>
        <div class="hint" id="hint">タップ：ピン追加 / ピン：+1 / ピン長押し：名前</div>
      </div>
    </div>

    <div class="bottom">
      <div class="sum" id="sum">計 0点 <small id="sum2">（0ピン）</small></div>
      <button class="btn" id="btnHelp"><span class="msr">help</span>使い方</button>
      <button class="btn" id="btnClear"><span class="msr">delete</span>全消し</button>
    </div>

    <div class="sheet" id="sheet" aria-hidden="true">
      <div class="sheetCard">
        <div class="sheetTitle">使い方</div>
        <div class="sheetText">
          ・写真（白紙）をタップ：ピン追加（×1）<br>
          ・ピンをタップ：数量 +1<br>
          ・ピンを長押し：メニュー名入力（表示は省略可）<br>
          ・全消し：ピンをすべて削除<br>
          ※ UI確認用（撮影/認識は未実装）
        </div>
        <div class="sheetRow">
          <button class="btn" id="btnClose">OK</button>
          <button class="btn primary" id="btnHint">ヒント切替</button>
        </div>
      </div>
    </div>

    <div class="labelModal" id="labelModal" aria-hidden="true">
      <div class="labelCard">
        <div class="labelTitle">メニュー名</div>
        <div class="labelSub">例：生 / ハイ / 唐揚げ / 枝豆（未入力OK）</div>
        <input class="labelInput" id="labelInput" type="text" inputmode="text" autocomplete="off" placeholder="メニュー名を入力" />
        <div class="labelRow">
          <button class="btn" id="btnLabelCancel">キャンセル</button>
          <button class="btn primary" id="btnLabelSave">保存</button>
        </div>
      </div>
    </div>

    <script>
      // Fail-fast diagnostics (optional; comment out if annoying)
      window.addEventListener('error', (e)=>{ console.error(e.error||e); alert('JSエラー: ' + e.message); });
      window.addEventListener('unhandledrejection', (e)=>{ console.error(e.reason); alert('Promiseエラー: ' + (e.reason?.message||e.reason)); });

      document.addEventListener('DOMContentLoaded', ()=>{
        const $ = (s)=>document.querySelector(s);
        const $$ = (s)=>[...document.querySelectorAll(s)];

        const DEMO_SRC = "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?auto=format&fit=crop&w=1200&q=80";
        const BLANK_SVG = 'data:image/svg+xml;utf8,' + encodeURIComponent(`
          <svg xmlns="http://www.w3.org/2000/svg" width="1200" height="1600">
            <defs>
              <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#f8fafc"/>
                <stop offset="1" stop-color="#eef2ff"/>
              </linearGradient>
            </defs>
            <rect width="1200" height="1600" fill="url(#g)"/>
            <g opacity="0.55">
              <path d="M0 260H1200" stroke="#e2e8f0" stroke-width="2"/>
              <path d="M0 520H1200" stroke="#e2e8f0" stroke-width="2"/>
              <path d="M0 780H1200" stroke="#e2e8f0" stroke-width="2"/>
              <path d="M0 1040H1200" stroke="#e2e8f0" stroke-width="2"/>
              <path d="M0 1300H1200" stroke="#e2e8f0" stroke-width="2"/>
            </g>
          </svg>
        `);

        const state = { started:false, pins:[] };

        function escapeHtml(str){
          return String(str)
            .replace(/&/g,'&amp;')
            .replace(/</g,'&lt;')
            .replace(/>/g,'&gt;')
            .replace(/"/g,'&quot;')
            .replace(/'/g,'&#39;');
        }

        function total(){ return state.pins.reduce((a,p)=>a+p.qty,0); }

        function recalc(){
          $('#sum').innerHTML = `計 ${total()}点 <small id="sum2">（${state.pins.length}ピン）</small>`;
          $('#btnShow').disabled = !state.started;
        }

        function pinSvg(){
          // Solid, icon-like pin (white fill)
          return `
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path fill="white" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5S13.38 11.5 12 11.5z"/>
            </svg>
          `;
        }

        // Label editor
        let editingPin = null;
        let lpTimer = null;
        let lpStart = null;

        function openLabelEditor(pin){
          editingPin = pin;
          $('#labelInput').value = pin.label || '';
          $('#labelModal').classList.add('on');
          $('#labelModal').setAttribute('aria-hidden','false');
          setTimeout(()=>{ $('#labelInput').focus(); $('#labelInput').select(); }, 0);
        }
        function closeLabelEditor(){
          editingPin = null;
          $('#labelModal').classList.remove('on');
          $('#labelModal').setAttribute('aria-hidden','true');
        }
        $('#btnLabelCancel').onclick = closeLabelEditor;
        $('#btnLabelSave').onclick = ()=>{
          if (editingPin){
            editingPin.label = ($('#labelInput').value || '').trim();
          }
          closeLabelEditor();
          renderPins();
        };

        function clearLongPress(){
          if (lpTimer){ clearTimeout(lpTimer); lpTimer = null; }
          lpStart = null;
        }

        function attachLongPress(el, pin){
          el.addEventListener('pointerdown', (e)=>{
            e.stopPropagation();
            clearLongPress();
            lpStart = { x:e.clientX, y:e.clientY };
            lpTimer = setTimeout(()=>{ openLabelEditor(pin); clearLongPress(); }, 420);
          });
          el.addEventListener('pointermove', (e)=>{
            if (!lpStart) return;
            if (Math.hypot(e.clientX-lpStart.x, e.clientY-lpStart.y) > 8) clearLongPress();
          });
          el.addEventListener('pointerup', clearLongPress);
          el.addEventListener('pointercancel', clearLongPress);

          // Touch fallback
          el.addEventListener('touchstart', (e)=>{
            e.stopPropagation();
            clearLongPress();
            const t = e.touches && e.touches[0];
            if (!t) return;
            lpStart = { x:t.clientX, y:t.clientY };
            lpTimer = setTimeout(()=>{ openLabelEditor(pin); clearLongPress(); }, 420);
          }, {passive:true});
          el.addEventListener('touchmove', (e)=>{
            const t = e.touches && e.touches[0];
            if (!t || !lpStart) return;
            if (Math.hypot(t.clientX-lpStart.x, t.clientY-lpStart.y) > 10) clearLongPress();
          }, {passive:true});
          el.addEventListener('touchend', clearLongPress);
          el.addEventListener('touchcancel', clearLongPress);
        }

        function renderPins(){
          const canvas = $('#canvas');
          $$('.pin').forEach(p=>p.remove());

          state.pins.forEach((p)=>{
            const el = document.createElement('div');
            el.className = 'pin';
            el.style.left = (p.x*100)+'%';
            el.style.top  = (p.y*100)+'%';

            const labelHtml = p.label ? `<div class="label">${escapeHtml(p.label)}</div>` : '';
            el.innerHTML = pinSvg() + `<div class="qty">×${p.qty}</div>` + labelHtml;

            attachLongPress(el, p);

            el.addEventListener('click', (e)=>{
              e.stopPropagation();
              // If long-press is in progress, click will still happen after pointerup in some browsers.
              // Cancel long press immediately on click to avoid accidental open.
              clearLongPress();
              p.qty = Math.min(99, p.qty + 1);
              el.querySelector('.qty').textContent = `×${p.qty}`;
              recalc();
            });

            canvas.appendChild(el);
          });

          recalc();
        }

        function addPinAt(clientX, clientY){
          const rect = $('#canvas').getBoundingClientRect();
          const x = (clientX - rect.left) / rect.width;
          const y = (clientY - rect.top) / rect.height;
          state.pins.push({
            x: Math.max(0,Math.min(1,x)),
            y: Math.max(0,Math.min(1,y)),
            qty: 1,
            label: ''
          });
          renderPins();
        }

        function startWith(src){
          $('#empty').classList.remove('on');
          $('#canvas').classList.add('on');
          $('#img').src = src;
          state.started = true;
          state.pins = [];
          renderPins();
          $('#sub').textContent = 'タップでピン追加 / ピンで+1 / 長押しで名前';
        }

        // Start buttons
        $('#btnDemo').onclick = ()=>startWith(DEMO_SRC);
        $('#btnBlank').onclick = ()=>startWith(BLANK_SVG);

        // Add pin by tapping canvas
        $('#canvas').addEventListener('click', (e)=>{
          if (!state.started) return;
          if ($('#labelModal').classList.contains('on')) return;
          if (e.target.closest('.pin')) return;
          addPinAt(e.clientX, e.clientY);
        });

        // Bottom actions
        $('#btnHelp').onclick = ()=>{ $('#sheet').classList.add('on'); $('#sheet').setAttribute('aria-hidden','false'); };
        $('#btnClose').onclick = ()=>{ $('#sheet').classList.remove('on'); $('#sheet').setAttribute('aria-hidden','true'); };
        $('#btnHint').onclick = ()=>{
          const h = $('#hint');
          h.textContent = (h.textContent.includes('タップ：ピン追加')) ? 'ヒントを非表示（UI確認用）' : 'タップ：ピン追加 / ピン：+1 / ピン長押し：名前';
        };

        $('#btnClear').onclick = ()=>{
          state.pins = [];
          renderPins();
        };

        $('#btnShow').onclick = ()=>alert('提示モード（UIのみ）');

        // Reset: back to photo choice screen
        $('#btnResetHeader').onclick = ()=>{
          state.started = false;
          state.pins = [];
          $('#img').src = '';
          $('#canvas').classList.remove('on');
          $('#empty').classList.add('on');
          closeLabelEditor();
          $('#sheet').classList.remove('on');
          recalc();
        };


        recalc();
      });
    </script>
  </div>
</body>
</html>
